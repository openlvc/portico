<?xml version="1.0">

<!--
# ===================================================================================
# ////////////////////////  Portico RTI Initialization Data  ////////////////////////
# ===================================================================================
#
# This file contains all available configuration options for Portico. 
# Values provided are shown with defaults. Inline documentation is provided throughout.
#
# To make use of this file, put it in the directory that your federate is executed from, or set the
# RTI_RID_FILE environment variable to point at wherever it is located.
#
# --------------------------------------
# 1. Network Connection Configuration
# --------------------------------------
# The configuration structure for network connections across the RTI, LRC and Forwarder has
# a large amount of overlap. While the number of connections you have specify for each of
# the applications differs, the configuration properties you can specify a largely the same.
#
# A connection definition has a common structure:
#
#     <connection name="your-name" transport="%TRANSPORT%" enabled="true">
#         <%TRANSPORT%>  // can be multicast, tcp-server, tcp-client or jvm
#         <protocols>
#             ...
#         </protocols>
#     </connection>
#
# In the main <connection> element has three attributes:
#     - name: A unqiue name to identify the connection (used in logging)
#     - transport: The transport implementation use by the connection
#     - protocols: The protocol stack supporting the connection
#
#
#    1.1 Transport Implementations
#    --------------------------
#    The transport implementation defines the network communication model used for the connection.
#    There must be a sub-element of <connection> that has the same value. This is where transport
#    specific configuration information is kept. For example:
#
#    <connection name="myconnection" transport="multicast" enabled="true">
#        <multicast address="239.1.2.3" port="20913" nic="SITE_LOCAL"/>
#    </connection>
#
#    In the above, the connection is declared to have a "multicast" transport. The <multicast>
#    sub-element provides transport-specific configuration information. Note the value of the
#    "nic" attribute (see Network Interface Symbolic Names). Valid transports are:
#
#      - multicast: Uses multicast or broadcast group for message exchange
#      - tcp-server: TCP, point-to-point. Listens for connections from clients.
#      - tcp-client: TCP, point-to-point. Client side of connection. Connects to tcp-server.
#      - jvm: Shared-memory. Federates must run in same process. Usually in differnet threads.
#
#
#    1.2 Protocol Stack
#    --------------------------
#    Each connection can have a protocols stack. Protocols are units of functionality that
#    process and augment messages in some way. Some protocols are only available in some
#    components. For example, the <encryption> protocol can be used anywhere, but the
#    <forwarding> protocol can only be used in the Forwarder (manually injected in code).
#
#    The stack has two directions: 
#        - down() From Application >>> Transport
#        -   up() From Transport >>> Application
#
#      Application      | Messages sent to the network are
#         Protocol #1   | passed "down" the stack, to each
#         Protocol #2   | protocol in the order declared here.
#         Transport     V
#
#    When a message is received from the transport, it is passed "up" the stack.
#    The message is passed to each protocol in **REVERSE** order (from bottom to top).
#
#    Currently, the only protocol available for configuration via the RID is the <encryption>
#    protocol.
#
#
# --------------------------------------
# 2. Network Interface Symbolic Names
# --------------------------------------
# For any place where an IP address or name could validly be entered, you can instead use a more
# generic, symbolic string. When a symbolic name is used, Portico will substitute it for the first
# address or NIC it can find that matches. The following symbolic names are available:
#
#  - LOOPBACK:   127.0.0.1
#  - LINK_LOCAL: 169.254.1.0 - 169.254.254.255 inclusive
#  - SITE_LOCAL: 10.0.0.0/8 (255.0.0.0), 172.16.0.0/12 (255.240.0.0), 192.168.0.0/16 (255.255.0.0)
#  - GLOBAL:     Any address not in the above
#
-->


<portico>
	<!--
	# ==================================================================================
	# ///  Common Configuration  ///////////////////////////////////////////////////////
	# ==================================================================================
	-->
	<common>
		<!--
		# (C.1) Common Logging Properties
		#        Specify level and directory. Settings are common across RTI, LRC and Forwarder.
		#        You can also specify the log4j pattern that is used to format the log messages.
		-->
		<logging logdir="logs"
		         loglevel="INFO"
		         logformat="%d{ABSOLUTE} %-5p %c: %m%n"/>

		<!--
		# (C.2) Special Configuration Options
		#        This section has a set of misc configuration options.
		-->
		<special>
			<jgroups loglevel="OFF"/>
		</special>
	</common>

	<!--
	# ==================================================================================
	# ///  RTI Configuration  //////////////////////////////////////////////////////////
	# ==================================================================================
	-->
	<rti>
		<!--
		# (R.1) RTI Home Location
		#
		#        The location of the RTI installation. Can be overridden by the env-var RTI_HOME.
		#
		-->
		<rti-home> ./ </rti-home>

		<!--
		# (R.2) RTI Data Directory
		#
		#        The location to write log files, federation save files and all other data to.
		#        While core RTI files are often installed into Program Files or other privileged
		#        areas on Linux, the data directory typically points to subfolder of a users home
		#        directory or some other place that is writable without administrative privileges.
		#
		-->
		<!-- <rti-data> ${user.home}\Portico </rti-data>  --> <!-- // Windows -->
		<!-- <rti-data> ${user.home}/.portico </rti-data> --> <!-- // Linux   -->


		<!--
		# (R.3) RTI Network Connections
		#
		#        The RTI can maintain a arbitrary number of network connections, allowing it
		#        to speak on many networks at once.
		#
		#        The <network> element may contain a number of <connection> definitions.
		#        Each must have a unique name and must identify a transport. It can also
		#        be enabled/disabled via the "enabled" property.
		#
		#        Sub-component configuration options for individual connection definitions
		#        are common across RTI, LRC and Forwarder components. See the section called
		#        "Network Connection Configuration" at the top of this file for a detailed
		#        discussion of valid structure.
		#
		-->
		<network>
			<!--
			# (R.4) Multicast Connection
			#
			#        A connection that communicates via local multicast groups. Uses the
			#        JGroups reliable multicast library to support its message exchange.
			-->
			<connection name="multicast" transport="multicast" enabled="true">

				<!--
				# (R.4a) Multicast Transport Configuration
				#
				#    Address: A valid multicast or broadcast ip, or the symbolic name BROADCAST.
				#       Port: Any valid port number. Default: 20913.
				#        NIC: The address or host name of the NIC we should use to send/receive traffic, or
				#             one of the symbolic names from above (LOOPBACK, LINK_LOCAL, SITE_LOCAL, GLOBAL).
				#
				-->
				<multicast address="239.1.2.3" port="20913" nic="SITE_LOCAL"/>

				<!--
				# (R.4b) Protocol Stack
				#
				#         A stack of message reading and modifying protocol implementations.
				#         The stack has two directions: 
				#             - down() From Application >>> Transport
				#             -   up() From Transport >>> Application
				#
				#         Application      | Messages sent to the network are
				#            Protocol #1   | passed "down" the stack, to each
				#            Protocol #2   | protocol in the order declared here.
				#            Transport     V
				#
				#         When a message is received from the transport, it is passed
				#         "up" the stack in the REVERSE order as configured here.
				#
				-->
				<protocols>
					<!--
					# (R.4c) Encryption Settings
					#
					#     Enabled: Is the protocol on/off? If disabled, wont be added
					#   Keylength: Bit-length of federation shared key. 128-bit (DEFAULT)
					#              Stronger levels required Java unlimited strength policies (google it)
					#      Cipher: Cipher configuration string.
					#
					#   Supported Ciphers
					#     AES Only. Further, only those modes that yield a cipher text that is
					#     the same side as the plain text are currently supported:
					#         - "AES/CFB/NoPadding"
					#         - "AES/CTR/NoPadding"
					#         - "AES/CBC/CS3Padding" 
					#
					-->
					<encryption enabled="false" kenlength="128" cipher="AES/CFB/NoPadding"/>
				</protocols>
			</connection>


			<!--
			# (R.5) Unicast TCP Network Connection
			#
			#        This connection opens a socket and listens for incoming connection
			#        requests from "tcp-client" connections. It established a reliable,
			#        point-to-point TCP connection between the server and any number of
			#        clients that connect.
			#
			-->
			<connection name="tcp" transport="tcp-server" enabled="true">
				<!--
				# (R.5a) Unicast Server Transport Configuration
				#
				#     Address: IP or hostname of address to listen on. Can substitute for one of
				#              the symbolic names and the first address found on the associated
				#              NIC will be used (LOOPBACK, LINK_LOCAL, SITE_LOCAL, GLOBAL).
				#       Port: The port number to listen on. Default: 52295.
				#
				-->
				<tcp-server address="SITE_LOCAL" port="52295"/>

				<protocols>
					<encryption enabled="false" kenlength="128" cipher="AES/CFB/NoPadding"/>
				</protocols>
			</connection>


			<!--
			# (R.6) JVM Network Connection Configuration
			#
			#        Use an internal, local-process only shared memory exchange.
			#        Federates must be running in the same process, typically as
			#        separate threads.
			#
			-->
			<connection name="jvm" transport="jvm" enabled="true">
				<jvm/> <!-- no properties by default -->
				<protocols/>
			</connection>

		</network>
	</rti>


	<!--
	# ==================================================================================
	# ///  LRC Configuration  //////////////////////////////////////////////////////////
	# ==================================================================================
	-->
	<lrc>

		<!--
		# (L.1) LRC Network Connection
		#        The LRC can only have an SINGLE CONNECTION at once. It uses this to
		#        communicate with the RTI (directly or through a Forwarder).
		#
		#        The <network> element main only contain a SINGLE <connection> definition.
		#        We have provided placeholders for other types with default configuration
		#        information, but have commented them out.
		#
		#        Sub-component configuration options for individual connection definitions
		#        are common across RTI, LRC and Forwarder components. See the section called
		#        "Network Connection Configuration" at the top of this file for a detailed
		#        discussion of valid structure.
		#
		-->
		<network>
			<connection name="lrc" transport="multicast" enabled="true">
				<!--
				# (L.2) Multicast Transport
				#
				#    Address: A valid multicast or broadcast ip, or the symbolic name BROADCAST.
				#       Port: Any valid port number. Default: 20913.
				#        NIC: The address or host name of the NIC we should use to send/receive traffic, or
				#             one of the symbolic names from above (LOOPBACK, LINK_LOCAL, SITE_LOCAL, GLOBAL).
				#
				-->
				<multicast address="239.1.2.3" port="20913" nic="SITE_LOCAL"/>

				<!--
				# (L.3) Unicast Client Transport
				#
				#         Connects to a tcp-server connection running at the location configured.
				#         
				#     Address: IP or hostname of address to listen on. Can substitute for one of
				#              the symbolic names and the first address found on the associated
				#              NIC will be used (LOOPBACK, LINK_LOCAL, SITE_LOCAL, GLOBAL).
				#       Port: The port number to listen on. Default: 52295.
				#
				-->
				<!-- <tcp-client address="SITE_LOCAL" port="52295"/> -->

				<!--
				# (L.4) JVM Network Connection Configuration
				#
				#        Use an internal, local-process only shared memory exchange.
				#        Federates must be running in the same process.
				#
				-->
				<!-- <jvm/> -->

				<!--
				# (L.5) Protocol Stack
				#
				#         A stack of message reading and modifying protocol implementations.
				#         The stack has two directions: 
				#             - down() From Application >>> Transport
				#             -   up() From Transport >>> Application
				#
				#         Application      | Messages sent to the network are
				#            Protocol #1   | passed "down" the stack, to each
				#            Protocol #2   | protocol in the order declared here.
				#            Transport     V
				#
				#         When a message is received from the transport, it is passed
				#         "up" the stack in the REVERSE order as configured here.
				-->
				<protocols>
					<!--
					# (L.5a) Encryption Settings
					#
					#     Enabled: Is the protocol on/off? If disabled, wont be added
					#   Keylength: Bit-length of federation shared key. 128-bit (DEFAULT)
					#              Stronger levels required Java unlimited strength policies (google it)
					#      Cipher: Cipher configuration string.
					#
					#   Supported Ciphers
					#     AES Only. Further, only those modes that yield a cipher text that is
					#     the same side as the plain text are currently supported:
					#         - "AES/CFB/NoPadding"
					#         - "AES/CTR/NoPadding"
					#         - "AES/CBC/CS3Padding" 
					#
					-->
					<encryption enabled="false" kenlength="128" cipher="AES/CFB/NoPadding"/>
				</protocols>
			</connection>
		</network>

	</lrc>


	<!--
	# ==================================================================================
	# ///  Forwarder Configuration  ////////////////////////////////////////////////////
	# ==================================================================================
	#
	# The Forwarder is designed to bridge networks, whether that be because they
	# are not local, or because there is some need for an administrative boundary
	# between them. The forwarder will pass messages in two directions:
	#
	#       Upstream: Connection between Forwarder and RTI network
	#     Downstream: Connection between Forwarder and local cluster of federates
	#
	#          (RTI) <<<<< Forwarder >>>>> (Local Federates)
	#             {upstream}      {downstream}
	#
	# There is a separate network connection for each direction that reflects how the
	# forwarder will talk to the RTI/Upstream (F.1) and Local Federates/Downstream (F.2).
	#
	# To restrict traffic flow, a firewall can be configured (F.3).
	-->
	<forwarder>

		<!--
			NOTE: A Forwarder can only have TWO connections. One called "upstream" and
			      one called "downstream". Other names, or configs that are missing both
			      connections will cause a startup failure.
		-->
		<network>
			<!--
			# (F.1) Upstream Connection
			#
			#       The forwarder upstream connection is our link back to the RTI. The config
			#       information should point to somewhere that an RTI is currently running,
			#       or to the next-hop forwarder.
			#
			#       The firewall settings later in the configuration let you control what
			#       messages are filtered out as they RECEIVED from the upstream connection
			#       and "imported" into the downstream cluster.
			#
			#       Valid transport types are: multicast and tcp-client (default).
			#
			<connection name="upstream" transport="tcp-client">
				<!--
				# (F.1a) Unicast Client Transport
				#
				#        Connects to a tcp-server connection running at the location configured.
				#         
				#     Address: IP or hostname of address to listen on. Can substitute for one of
				#              the symbolic names and the first address found on the associated
				#              NIC will be used (LOOPBACK, LINK_LOCAL, SITE_LOCAL, GLOBAL).
				#       Port: The port number to listen on. Default: 52295.
				#
				-->
				<tcp-client address="SITE_LOCAL" port="52295"/>

				<!--
				# (F.1b) Protocol Stack (FORWARDER-SPECIFIC)
				#
				#        Internally, the forwarder inserts its own special forwarding protocol
				#        that intercepts messages before they reach the application level and
				#        must be fully inflated (incurring a heavy compute cost).
				#
				#        For the forwarder to work correctly, NEVER use a protocol that modifies
				#        the contents. The forwarder should just hand messages on. Do not add
				#        <encryption> into either the upstream or downstream protocol stacks. 
				#
				-->
				<protocols/>
			</connection>

			<!--
			# (F.2) Downstream Connection
			#
			#       Represents the connection to the local cluster or federate.
			#       The transport should reflect how the local cluster federates are going
			#       to connect to the forwarder.
			#
			#       The firewall settings later in the configuration let you control what
			#       messages are filtered out as they RECEIVED from the downstream connection
			#       and "exported" from the local cluter.
			#
			#       Valid transports are: multicast (default) and tcp-server (so clients can connect to us)
			#
			<connection name="downstream" transport="multicast">
				<!--
				# (F.2a) Multicast Transport
				#
				#    Address: A valid multicast or broadcast ip, or the symbolic name BROADCAST.
				#       Port: Any valid port number. Default: 20913.
				#        NIC: The address or host name of the NIC we should use to send/receive traffic, or
				#             one of the symbolic names from above (LOOPBACK, LINK_LOCAL, SITE_LOCAL, GLOBAL).
				#
				-->
				<multicast address="239.1.2.3" port="20913" nic="SITE_LOCAL"/>


				<!--
				# (F.2b) Protocol Stack (FORWARDER-SPECIFIC)
				#
				#        Internally, the forwarder inserts its own special forwarding protocol
				#        that intercepts messages before they reach the application level and
				#        must be fully inflated (incurring a heavy compute cost).
				#
				#        For the forwarder to work correctly, NEVER use a protocol that modifies
				#        the contents. The forwarder should just hand messages on. Do not add
				#        <encryption> into either the upstream or downstream protocol stacks. 
				#
				-->
				<protocols/>
			</connection>
		</network>


		<!--
		# (F.3) Forwarder Firewall
		#
		#       To support increased scalability, the forwarder can act as a firewall.
		#       When enabled, it will prevent all data messages (attributes updates and interactions)
		#       from passing in either direction through the forwarder.
		#
		#       To allow data through, users configure which interaction and object classes are
		#       allowed to be IMPORTED from upstream>>>downstream (F.3a) and which are allowed to
		#       be EXPORTED from downstream>>>upstream (F3.b).
		#
		#       This allows the forwarder to prevent overly chatty local clusters from overwhelming
		#       a federation or a long-haul link with unnecessary traffic.
		#
		#       The firewall is DISABLED by default for efficiency reasons. If you need this
		#       functionality, you can specify "enabled=true".
		#
		#       == Note==
		#       The firewall only affects _DATA_ messages (attribute updates and interactions).
		#       These are the vast majority of federation traffic by both volume and bandwidth.
		#       All control-type messages (everything else) will pass through in both directions.
		#
		-->
		<firewall enabled="false">

			<!--
			# (F.3a) Firewall Import Rules
			#
			#        A list of all classes for which attribute updates and interactions are ALLOWED
			#        to pass through the firewall in the upstream>>>downstream direction.
			#
			#        If a data message is received from the RTI and it does NOT match one of the
			#        listed types, it will be dropped, and wont pass to the local cluster.
			#
			#        Class names MUST be fully qualified to match, but are case-insensitive.
			#        The wildcard '*' character matches any relevant character sequence in a name.
			#        You can specify multiple <object/> and <interaction/> entries.
			#
			-->
			<import>
				<object class="HLAobjectRoot.*"/>
				<interaction class="HLAinteractionRoot.*"/>
			</import>

			<!--
			# (F.3a) Firewall Export Rules
			#
			#        A list of all classes for which attribute updates and interactions are ALLOWED
			#        to pass through the firewall in the upstream<<<downstream direction.
			#
			#        If a data message is received from the local cluster and it does NOT match
			#        one of the listed types, it will be dropped, and wont pass to the RTI.
			#
			#        Class names MUST be fully qualified to match, but are case-insensitive.
			#        The wildcard '*' character matches any relevant character sequence in a name.
			#        You can specify multiple <object/> and <interaction/> entries.
			#
			-->
			<export>
				<object class="HLAobjectRoot.*"/>
				<interaction class="HLAinteractionRoot.*"/>
			</export>

		</firewall>

	</forwarder>

</portico>
